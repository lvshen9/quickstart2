(function(a){if(typeof(a.importFile)=="undefined"){a.importFile=function(c,b){return new a.importFile.fn.construct(c,b);};a.importFile.fn={construct:function(c,b){this.id=c;a.extend(this,b);},init:function(){var c=a("#importDiv_"+this.id);if(!c||!c.length){var b=[];b.push('<div class="c_option" id="importDiv_'+this.id+'" style="width:320px;">');
b.push('	<div class="c_optionContent" id="importDivCont_'+this.id+'" >');b.push('		<div class="c_form c_form-col-1 c_form-label-2" id="option1_'+this.id+'">');b.push('			<ul class="ul">');b.push('				<li class="li">');b.push('					<span class="label">'+a.lang["view.web.comp.import.file"]+"</span>");b.push('					<span class="e_elements">');
b.push('						<button class="e_button-right" onclick="javascript:$.uploadFile(\'#uploadForImport_'+this.id+'\')"><i class="e_ico-upload"></i>');b.push("						<span>"+a.lang["view.web.comp.import.upload"]+'</span></button><span class="e_input e_input-left">');b.push('						<span><input readOnly="true" type="text" id="UPLOAD_uploadForImport_'+this.id+'" name="UPLOAD_uploadForImport_'+this.id+'" desc="'+a.lang["view.web.comp.import.upload"]+'" value="'+a.lang["view.web.comp.import.choose"]+'"/>');
b.push('						<input type="hidden" id="uploadForImport_'+this.id+'" name="uploadForImport_'+this.id+'" fileLimit="1"');if(this.ftpSite){b.push('ftpSite="'+this.ftpSite+'"');}if(this.filePath){b.push('filePath="'+this.filePath+'"');}if(this.fileSize){b.push('fileSize="'+this.fileSize+'"');}if(this.fileTypes){b.push('fileTypes="'+this.fileTypes+'"');
}if(this.fileTypesDesc){b.push('fileTypesDesc="'+this.fileTypesDesc+'"');}b.push("/>");b.push("					</span></span></span>");b.push("				</li>");b.push('				<li class="li">');b.push('					<span id="tip_'+this.id+'"class="e_tip" >'+a.lang["view.web.comp.import.size"]+"</span>");b.push("				</li>");b.push('				<li class="li">');
b.push('					<span class="e_tip">'+a.lang["view.web.comp.import.tip"]+"</span>");b.push("				</li>");b.push("			</ul>");b.push('			<div class="submitPlace"></div>');b.push('			<div class="submit">');b.push('				<button class="e_button-form" onclick="'+this.id+".end();"+this.id+'.onImportAction(\'cancel\');"><i class="e_ico-cancel"></i><span>'+a.lang["view.web.comp.import.cancel"]+"</span></button>");
b.push('				<button class="e_button-form" onclick="'+this.id+'.beginUpload()" ><i class="e_ico-play"></i><span>'+a.lang["view.web.comp.import.begin"]+"</span></button>");b.push("			</div>");b.push("		</div>");b.push("	</div>");b.push('	<div class="c_optionShadow"></div>');if(a.browser.msie&&a.browser.version<=6){b.push('<iframe class="c_optionCover"></iframe>');
}b.push("</div>");a.appendContextMenu(a("#"+this.id+"_ImportButton"),c,b.join(""),250,"importDiv_"+this.id);this.offset();a.updateTopPos(a("#"+this.id+"_ImportButton"),"importDiv_"+this.id);function d(e){return function(h){var g=h.target;while(g!=null&&g.nodeName!="BODY"){var f=a(g).attr("id");if(f=="importDiv_"+e||f=="wade_fileupload_div"||f==e+"_ImportButton"||f==e+"_ShowButton"){return true;
}else{g=g.parentNode;}}if("hidden"!=a("#importDiv_"+e).css("visibility")){a("#importDiv_"+e).css("visibility","hidden");}};}a(document).bind("mousedown",d(this.id));a("#importDiv_"+this.id).bind("click",function(){return false;});a("#importDiv_"+this.id).css("visibility","visible");}else{this.show();
}c=null;},start:function(){a("#"+this.id+"_ImportButton").css("display","none");a("#"+this.id+"_Importing").css("display","");return true;},end:function(){a("#importDiv_"+this.id).remove();a("#"+this.id+"_ImportButton").css("display","");a("#"+this.id+"_ImportButton").attr("stopped","");a("#"+this.id+"_Importing").css("display","none");
},offset:function(){var d=a("#"+this.id+"_Importing");var g=a("#"+this.id+"_ImportButton");var f=a("#"+this.id+"_ShowButton");var e="importDiv_"+this.id;var h=parseInt(a("#"+e).css("width"),10);var b=a.initPosition(g,h,e,f,d);var c=a("#importDiv_"+this.id);c.css("left",b.leftPx+"px");c.css("top",b.topPx+"px");
},show:function(){var b=a("#importDiv_"+this.id);if(b&&b.length){if("hidden"==b.css("visibility")){this.offset();b.css("visibility","visible");}else{b.css("visibility","hidden");}}else{this.init();}b=null;},beforeImportAction:function(){var b=true;if(!this.beforeAction){return b;}if(a.isFunction(this.beforeAction)){b=this.beforeAction.call(this,this.id);
}else{b=new Function("return "+this.beforeAction)().call(this,this.id);}return b;},afterImportAction:function(c){var b=true;if(!this.afterAction){return b;}if(a.isFunction(this.afterAction)){b=this.afterAction.call(this,c,this.id);}else{b=new Function("return "+this.afterAction)().call(this,c,this.id);
}return b;},onImportAction:function(c){var b=true;if(!this.action){return b;}if(a.isFunction(this.action)){b=this.action.call(this,c,this.id);}else{b=new Function("return "+this.action)().call(this,c,this.id);}return b;},beginUpload:function(){var e=a("#uploadForImport_"+this.id).val();if(!e){a("#tip_"+this.id).html('<span class="e_orange">'+a.lang["view.web.comp.import.notnull"]+"</span>");
return;}if(!this.beforeImportAction()){return;}this.start();var f=[];f.push('<div class="c_article" id="option2_'+this.id+'" ><!-- 正在导入 -->');f.push("	<div>"+a.lang["view.web.comp.import.importing"]+"</div>");f.push('	<span class="e_progress e_progress-big l_mt">');f.push('		<span class="e_progressBar" id="progressBar_'+this.id+'" style="width:0%;"></span>');
f.push('		<span class="e_progressValue" id="progressValue_'+this.id+'" >0%</span>');f.push("	</span>");f.push('	<div class="l_mt" id="importing_info_'+this.id+'" >'+a.lang["view.web.comp.import.parsing"]+" </div>");f.push('	<div class="l_mt e_right">');f.push("		<span> </span>");f.push('		<button type="button" class="e_button-form" onclick="'+this.id+'.stop();"><i class="e_ico-cancel"></i><span>'+a.lang["view.web.comp.import.stop"]+"</span></button>");
f.push("	</div>");f.push("</div>");a("#importDivCont_"+this.id).html(f.join(""));this.offset();function h(k,j){return function(o){if(arguments[1]==="success"){a("#"+k+"_ImportButton").attr("fileSerializeId",o["fileSerializeId"]);if(a("#progressBar_"+k)&&o["progress"]&&o["progress"]!="null"){a("#progressBar_"+k).attr("style","width:"+o["progress"]+"%;");
}if(a("#progressValue_"+k)&&o["progress"]&&o["progress"]!="null"){a("#progressValue_"+k).text(o["progress"]+"%");}if(a("#importing_info_"+k)&&o["hint"]&&o["hint"]!="null"){a("#importing_info_"+k).text(o["hint"]);}var l=j+"?fileSerializeId="+o["fileSerializeId"]+"&listenerMethod=refreshStatus&fresh="+Math.random();
function m(w,v,u){return function(){if(a("#"+w+"_ImportButton").attr("stopped")){return;}a.post(v,"",h(w,u),"json");};}if((o["progress"]=="null"&&o["status"]=="null")||(o["progress"]<100&&o["progress"]>0&&o["status"]=="ok")){setTimeout(m(k,l,j),2000);}else{if(o["progress"]=="0"||o["status"]=="error"){var p=[];
p.push('<div class="c_article" id="uploadFailed_'+k+'"><!-- 导入失败 -->');p.push('	<span class="e_red">'+a.lang["view.web.comp.import.fail"]+"</span><br />");p.push('	<div class="l_mt">');p.push(o["hint"]);p.push("	</div>");p.push(a.lang.get("view.web.comp.import.excp",'<a href="#nogo" onclick="'+k+".end();"+k+'.init()">',"</a>"));
p.push('	<div class="l_mt e_right">');p.push('		<button class="e_button-form" onclick="'+k+".end();"+k+'.onImportAction(\'fail\');"><i class="e_ico-ok"></i><span>'+a.lang["view.web.comp.import.ok"]+"</span></button>");p.push("	</div>");p.push("</div>");a("#importDivCont_"+k).html(p.join(""));p=null;window[k].afterImportAction("error");
}else{if(o["progress"]=="100"&&o["status"]=="ok"){var p=[];p.push('<div class="c_article" id="option3_'+k+'"><!-- 导入完成 -->');p.push("	<div>"+a.lang["view.web.comp.import.compl"]+"</div>");p.push('	<span class="e_progress e_progress-big e_progress-ok l_mt">');p.push('		<span class="e_progressBar" style="width:100%;"></span>');
p.push('		<span class="e_progressValue">100%</span>');p.push("	</span>");p.push('	<div class="l_mt">');if(o["status"].indexOf("span")>0){p.push(o["status"]);}else{var q=o["hint"].split(",");var n=q[0];var t=q[1];if(t&&t>0){p.push(a.lang.get("view.web.comp.import.sucs",n+" ",'<span class="e_red">'+t,"</span>")+a.lang["view.web.comp.import.download"]);
}else{p.push(a.lang.get("view.web.comp.import.sucs",n+" ",'<span class="e_green">0',"</span>"));}}p.push("	</div>");p.push('	<div class="l_mt e_right">');p.push('		<button class="e_button-form" onclick="'+k+".end();"+k+'.onImportAction(\'ok\');"><i class="e_ico-ok"></i><span>'+a.lang["view.web.comp.import.ok"]+"</span></button>");
p.push("	</div>");p.push("</div>");a("#importDivCont_"+k).html(p.join(""));var r=a("#importDivCont_"+k+" a:first");if(r){function s(u){return function(){window.location=encodeURI(encodeURI(u));};}r.bind("click",s(o["downloadUrl"]));}p=null;r=null;window[k].afterImportAction("ok");}}}}else{var p=[];p.push('<div class="c_article" id="uploadFailed_'+k+'"><!-- 导入失败 -->');
p.push('	<span class="e_red">'+a.lang["view.web.comp.import.fail"]+"</span><br />");p.push(a.lang.get("view.web.comp.import.excp",'<a href="#nogo" onclick="'+k+".end();"+k+'.init()">',"</a>"));p.push('	<div class="l_mt e_right">');p.push('		<button class="e_button-form" onclick="'+k+".end();"+k+'.onImportAction(\'fail\');"><i class="e_ico-ok"></i><span>'+a.lang["view.web.comp.import.ok"]+"</span></button>");
p.push("	</div>");p.push("</div>");a("#importDivCont_"+k).html(p.join(""));p=null;window[k].afterImportAction("error");}};}function g(j){return function(){var k=[];k.push('<div class="c_article" id="uploadFailed_'+j+'"><!-- 导入失败 -->');k.push('	<span class="e_red">'+a.lang["view.web.comp.import.fail"]+"</span><br />");
k.push(a.lang.get("view.web.comp.import.error",'<a href="#nogo" onclick="'+j+".end();"+j+'.init()">',"</a>"));k.push('	<div class="l_mt e_right">');k.push('		<button class="e_button-form" onclick="'+j+".end();"+j+'.onImportAction(\'fail\');"><i class="e_ico-ok"></i><span>'+a.lang["view.web.comp.import.ok"]+"</span></button>");
k.push("	</div>");k.push("</div>");a("#importDivCont_"+j).html(k.join(""));k=null;window[j].afterImportAction("error");};}var d="";if(this.params){d+="&"+this.params;}if(this.cond&&a.isString(this.cond)){var c=[];a.each(this.cond.split(","),function(j,l){c.push(a.ajax.buildPostData(l));var k=a("#"+l);
if(k&&k.length&&k.attr("exparams")&&k.attr("exparams")!=""){d+=k.attr("exparams");}k=null;});d+="&"+c.join("&");}var i="config="+this.config+"&ftpSite="+this.ftpSite+"&filePath="+this.filePath+"&fileId="+e+"&fileType="+this.fileType+"&model="+this.model+"&posX="+this.posX+"&posY="+this.posY;i+=d;var b=this.servletName+"?fileSerializeId=&listenerMethod=refreshStatus&serviceName="+this.serviceName+"&fresh="+Math.random();
a.ajaxRequest({url:b,data:i,type:"POST",dataType:"json",encoding:"UTF-8",timeout:10000,success:h(this.id,this.servletName),error:g(this.id),timeout:function(){alert("info:timeout");}});i=null;b=null;e=null;f=null;path=null;},stop:function(){var e=a("#"+this.id+"_ImportButton").attr("fileSerializeId");
var c=this.servletName+"?fileSerializeId="+e+"&listenerMethod=cancel&serviceName="+this.serviceName;function d(f){a("#"+f+"_ImportButton").attr("stopped","stopped");return function(h){var g=[];g.push('<div class="c_article" ><!-- 导入取消 -->');g.push('<span class="e_red">'+a.lang["view.web.comp.import.impcancel"]+"</span><br />");
g.push('	<div class="l_mt e_right">');g.push('		<button class="e_button-form" onclick="'+f+'.end()"><i class="e_ico-ok"></i><span>'+a.lang["view.web.comp.import.ok"]+"</span></button>");g.push("	</div>");g.push("</div>");a("#importDivCont_"+f).html(g.join(""));};}function b(f){a("#"+f+"_ImportButton").attr("stopped","stopped");
return function(g,i){var h=[];h.push('<div class="c_article" >');h.push('<span class="e_red">'+a.lang["view.web.comp.import.cancelexcp"]+"</span><br />");h.push(a.lang["view.web.comp.import.info"]+i+"<br />");h.push(a.lang["view.web.comp.import.errorinfo"]);h.push('	<div class="l_mt e_right">');h.push('		<button class="e_button-form" onclick="'+f+'.end()"><i class="e_ico-ok"></i><span>'+a.lang["view.web.comp.import.ok"]+"</span></button>");
h.push("	</div>");h.push("</div>");a("#importDivCont_"+f).html(h.join(""));};}a.ajaxRequest({url:c,data:"",type:"POST",dataType:"json",timeout:10000,success:d(this.id),error:b(this.id),timeout:function(){alert("info:timeout");}});this.onImportAction("terminate");}};a.importFile.fn.construct.prototype=a.importFile.fn;
}})(Wade);