(function(a){if(typeof(a.table)=="undefined"){a.table=function(c,b){return new a.table.fn.construct(c,b);};a.table.fn={construct:function(c,b){this.name="Table_"+c;this.tabName=c;this.tabHead=null;this.tag="tag";this.tabHeadSize=0;if(b){this.row_click_event=b.row_click_event;this.row_dblclick_event=b.row_dblclick_event;
this.column_click_event=b.column_click_event;this.column_dblclick_evnent=b.column_dblclick_evnent;}this.bindTableClickEvent();this.getTableHead();this.slipTable(this.tabName);a.extend(this,b);},getTable:function(){return a("#"+this.tabName);},selectedRow:function(c,f){var e=a.table.fn.get(c);var b=e.getTable().attr("selected");
if(b==null||b=="-1"){a(f).attr("class","on");}else{var d=e.getSelected();if(d&&d.length){if(d.attr("raw_class")){d.attr("class",d.attr("raw_class"));}else{d.attr("class","");}}a(f).attr("class","on");}e.getTable().attr("selected",f.rowIndex);},setRowCss:function(c,b){if(c&&c.length){if(b!=null&&b!=""&&b.indexOf("style=")!=-1){c.attr("style",b.substring(7));
}c.attr("class",b);c.attr("raw_class",b);}},bindTableClickEvent:function(){this.getTable().bind("click",[this.tabName],function(f){var d=a.table.fn.findParent(f.target,"TH");if(d){return true;}var c=a.table.fn.findParent(f.target,"TD");var b=a.table.fn.findParent(f.target,"TR");if(b){a.table.fn.selectedRow(f.data,b);
}if(c){if(window["Table_"+f.data]&&window["Table_"+f.data].column_click_event&&a.isFunction(window["Table_"+f.data].column_click_event)){window["Table_"+f.data].column_click_event(f);}}if(b&&!a("th:first",b).length){if(window["Table_"+f.data]&&window["Table_"+f.data].row_click_event&&a.isFunction(window["Table_"+f.data].row_click_event)){window["Table_"+f.data].row_click_event(f);
}}return true;});this.getTable().bind("dblclick",[this.tabName],function(w){var n=a.table.fn.findParent(w.target,"TH");if(n){return true;}var c=w.data[0];var d=a.table.fn.findParent(w.target,"TD");var t=a.table.fn.findParent(w.target,"TR");if(t){a.table.fn.selectedRow(c,t);}if(d){var k=a("#"+c+" th:nth-child("+(d.cellIndex+1)+")");
var l=a(d);if(k&&k.length){var j=k.attr("type");if(j&&j!=""){var r=l.attr("done");if(!r){var p=(""+l.text()).replace(/\r|\n|\s/ig,"");var s=l.attr("value");if(!s){s=p;}var v=a.style(d,"width");if(!v){a.style(d,"width",l.width()+"px");}l.addClass("edit");var m=[];switch(j){case"select":m.push('<span class="e_select" tag="edit"><span><span><select>');
var h=k.attr("options");if(h&&h!=""){h=h.split("○");var f;for(var u=0;u<h.length;u++){f=(""+h[u]).split("●");m.push('<option value="'+f[1]+'" '+(s==f[1]?"selected":"")+">"+f[0]+"</option>");}}m.push("</select></span></span></span>");break;case"datefield":var g=k.attr("arguments");m.push('<span class="e_elements" tag="edit">');
m.push('<button class="e_button-right" onclick="javascript:$(\'input[type=text]\',this.parentNode).trigger(\'click\');$.event.fix(event).stop();return false;"><i class="e_ico-date"></i><span></span></button>');m.push('<span class="e_input e_input-left"><span>');m.push('<input type="text" value="'+s+'" '+g);
m.push(' onclick="javascript:var e;if(e=$.event.fix(event)){$.datefield.events.onInputClick(e);e.stop();return false;}"');m.push(' onkeydown="javascript:var e;if(e=$.event.fix(event)){if(!$.datefield.events.onInputKeyDown(e)){e.stop();return false;}}"');m.push(' ondblclick="javascript:$.event.fix(event).stop();return false;" />');
m.push("</span></span>");m.push("</span>");break;case"popup":var q="popupText_"+(++a.guid);var b="popupValue_"+(++a.guid);var o=k.attr("isReadOnly");var g=k.attr("arguments");g=g.replace("{params}","");g=g.replace("{eventId}",b);g=g.replace("{frameName}","");m.push('<span class="e_elements" tag="edit">');
m.push('<button class="e_button-right" onclick="javascript:popupPage.apply(window,\''+g+"'.split('○'));\"><i class=\"e_ico-check\"></i><span></span></button>");m.push('<span class="e_input e_input-left"><span><input id="'+q+'"');if(o==true){m.push(" readOnly=readOnly ");}m.push(' type="text" value="'+p+'" /><input id="'+b+'" textName="'+q+'" afterAction="'+k.attr("afterAction")+'" type="hidden" value="'+s+'"/></span></span>');
m.push("</span>");break;default:m.push('<span class="e_input" tag="edit"><span>');m.push('<input type="text" value="'+s+'"');m.push(' onclick="javascript:$.event.fix(event).stop();return false;" ');m.push(' ondblclick="javascript:$.event.fix(event).stop();return false;" />');m.push("</span></span>");
break;}l.html(m.join(""));}l.attr("done",true);l.find("input:first").select();}}if(window["Table_"+c]&&window["Table_"+c].column_dblclick_event&&a.isFunction(window["Table_"+c].column_dblclick_event)){window["Table_"+c].column_dblclick_event();}}if(t&&!a("th:first",t).length){if(window["Table_"+c]&&window["Table_"+c].row_dblclick_event&&a.isFunction(window["Table_"+c].row_dblclick_event)){window["Table_"+c].row_dblclick_event();
}}return true;});},findParent:function(d,b){var f=null;if(d){f=d;var c=0;while(f!=null&&f.nodeName!="TABLE"&&c<10){if(f.nodeName==b){return f;}else{f=f.parentNode;}c++;}}return null;},getTableHead:function(){var b=new a.DataMap();a("th",this.getTable()[0]).each(function(c,d){if(a(d).attr("col")){b.put(a(d).attr("col"),c);
}});this.tabHead=b;this.tabHeadSize=a("#"+this.tabName+" thead:first").children().length;},addContextMenu:function(c,d){var b=a.table.fn.findParent(d.target,"TR");if(b){a.table.fn.selectedRow(c,b);}},clickRow:function(d){var b=this.getTable().attr("selected");if(b==null||b=="-1"){a(d).attr("class","on");
}else{var c=this.getSelected();if(c&&c.length){if(c.attr("raw_class")){c.attr("class",c.attr("raw_class"));}else{c.attr("class","");}}a(d).attr("class","on");}this.getTable().attr("selected",d.rowIndex);},addRow:function(h,j,b,k){var d=a.table.get(this.tabName).getTable();var g=parseInt((j==null||j=="")?d.attr("selected"):j,10);
var i=this.tabHead;var f="";i.eachKey(function(o,e){var n=a("th[col="+o+"]");f+="<td ";if(n&&n.css("display")&&n.css("display")=="none"){f+=" style='display:none'";}if(b&&b[o]){f+=' class="'+b[o]+'"';}else{if(n&&n.attr("colcss")&&n.attr("colcss")!=""){f+=" class="+n.attr("colcss");}}if(h[o]){var p=n.attr("source");
if(p&&p!=""){var m=n.attr("values");var l="";a.each(m.split(","),function(q,r){l+=h[r]+",";});if(l.length>0){l=l.substring(0,l.length-1);}h[o]=translate(p,n.attr("names"),l,n.attr("key"),n.attr("default"));l=null;m=null;}p=null;f+=" >"+h[o]+"</td>";}else{f+=" ></td>";}});if(g!=-1){var c=a(d[0].rows[g]);
if(c&&c.length){if(k==false){a.insertAfter(a(d[0].rows[g]),{"tag":"tr","html":f},true);}else{a.insertAfter(a(d[0].rows[g]),{"tag":"tr","status":"0","class":"new","raw_class":"new","html":f},true);}return a(d[0].rows[g+1]);}else{alert(a.lang.get("table.addrow.index.isnull",g));f=null;return null;}}else{if(k==false){a.append(a("tbody",d[0]),{"tag":"tr","html":f},true);
}else{a.append(a("tbody",d[0]),{"tag":"tr","status":"0","class":"new","raw_class":"new","html":f},true);}f=null;return a("tbody tr:last",d[0]);}},updateRow:function(h,j,i){var f=a.table.get(this.tabName).getTable();var c=parseInt((j==null||j=="")?f.attr("selected"):j,10);var d="nochange";if(c!=-1){var g=this.tabHead;
var b;g.eachKey(function(l,k){if(h.hasOwnProperty(l)){b=h[l];var e=f[0].rows[c].cells[parseInt(g.get(l),10)];if(e.children[0]){if(a.nodeName(e.children[0],"input")){if(a(e.children[0]).val()!=b){d="changed";}a(e.children[0]).val(b);}else{if(a(e.children[0]).html()!=(""+b)){d="changed";}a(e.children[0]).html(""+b);
}}else{if(a(e).html()!=(""+b)){d="changed";}a(e).html(""+b);}}});if(!a(f[0].rows[c]).attr("status")&&d=="changed"&&i!=false){a(f[0].rows[c]).attr("status","2");a(f[0].rows[c]).attr("raw_class","edit");}return a(f[0].rows[c]);}else{alert(a.lang.get("table.updaterow.index.isnull"));return null;}},deleteRow:function(e,b){var c=a.table.get(this.tabName);
var d=c.getRowByIndex(e);if(!d||!d.length){c=null;d=null;return;}d.attr("raw_class","delete");if(b==null||b==true){d.css("display","none");d.attr("class","");}if(!d.attr("status")){d.attr("status","1");}else{if(d.attr("status")=="0"){d.remove();}else{if(d.attr("status")=="2"){d.attr("status","1");}}}if(b==null||b==true){c.getTable().attr("selected",-1);
}else{c.getTable().attr("selected",d.rowIndex);}d=null;c=null;},cleanRow:function(g){var f=a.table.get(this.tabName).getTable();var c=parseInt(f.attr("selected"),10);var b=f[0].rows[c];if(b){for(var d=0;d<b.cells.length;d++){a(b.cells[d]).html("");}}},isDeleted:function(b){var c=this.getRowByIndex(b);
if(!c||!c.length){tab=null;c=null;return false;}return c.attr("status")=="1";},isNew:function(b){var c=this.getRowByIndex(b);if(!c||!c.length){tab=null;c=null;return false;}return c.attr("status")=="0";},isUpdated:function(b){var c=this.getRowByIndex(b);if(!c||!c.length){tab=null;c=null;return false;
}return c.attr("status")=="2";},getCheckedRows:function(b){var d=a.table.get(this.tabName).getTable();var c=[];a("tbody input[type=checkbox],tbody input[type=radio]",d).each(function(e,f){if(a(f).attr("checked")){c.push(e);if(b&&a.isFunction(b)){var g=b.call(f,e,f);if(g==false){return false;}}}});return c;
},getCheckedRowDatas:function(e){var c=a.table.get(this.tabName).getTable();var b=new a.DatasetList();var d=this.tabName;a("tbody input[type=checkbox],tbody input[type=radio]",c).each(function(f,g){if(a(g).attr("checked")){b.add(a.table.get(d).getRowData(e,f+1));}});return b;},getRowByIndex:function(d){var b=a.table.get(this.tabName).getTable();
var c=null;if(d==null){c=a(b[0].rows[parseInt(b.attr("selected"),10)]);}else{if(a.isString(d)){c=a(b[0].rows[parseInt(d,10)]);}else{if(d&&a.isObject(d)&&a.isNodeName(d[0],"TR")){c=a(d);}}}b=null;return c;},cleanRows:function(b){a("tbody",this.getTable()[0]).html("");this.getTable().attr("selected","-1");
},get:function(b){return window["Table_"+b];},getTableData:function(g,f){var b=new a.DatasetList();var d=a.table.get(this.tabName);var c=a("tbody",d.getTable()[0]);var e=this.tabHeadSize;f=f!=null&&f==true;if(c){a("tr",c[0]).each(function(h,i){if(f){var j=d.getRowData(g,h+e);if(j){j.put("tag",a(i).attr("status"));
b.add(j);}j=null;}else{if(a(i).attr("status")=="0"||a(i).attr("status")=="1"||a(i).attr("status")=="2"){var j=d.getRowData(g,h+e);if(j){j.put("tag",a(i).attr("status"));b.add(j);}j=null;}}});}c=null;d=null;return b;},getColumnValue:function(d){if(!d||!d.nodeType){return;}var e=a("#"+this.tabName+" th:nth-child("+(d.cellIndex+1)+")");
var c=e.attr("type");var b=a.attr(d,"done");var f;if(!c&&!b){f=a("input:first",d).val();if(f==undefined){f=a.attr(d,"value");if(f==undefined){f=(""+a.trim(a(d).text())).replace(/\r|\n/ig,"");}}}else{switch(c){case"select":f=a("select:first",d).val();break;case"datefield":f=a("input:first",d).val();break;
case"popup":f=a("input[type=hidden]:first",d).val();break;default:f=a("input:first",d).val();break;}}return f;},getRowData:function(l,k){var b=this.getTable();var g=k==null?parseInt(b.attr("selected"),10):k;var e=new a.DataMap();if(g>=0){var m=b[0].rows[g-this.tabHeadSize+1];if(m==null||m=="undefined"){return null;
}if(l&&l!=""){var d=l.split(",");for(var f=0;f<d.length;f++){if(this.tabHead.containsKey(d[f])){var c=a(m.cells[parseInt(this.tabHead.get(d[f]),10)]);e.put(d[f],this.getColumnValue(c[0]));}}d=null;}else{var h=this,j=this.tabHead;j.eachKey(function(o,i){var n=m.cells[parseInt(j.get(o),10)];e.put(o,h.getColumnValue(n));
});j=null;}e.put("tag",a(m).attr("status"));}return e;},getSelected:function(d){var c=this.getTable()[0].rows[parseInt(this.getTable().attr("selected"),10)];if(c){if(d==null){return a(c);}else{if(a.isNumber(d)){if(d>=0&&d<c.cells.length){return a(c.cells[d]);}}else{if(a.isString(d)){var b=parseInt(this.tabHead.get(d),10);
if(b>=0&&b<c.cells.length){return a(c.cells[b]);}}}}}return null;},getCellByRowIndex:function(e,d){var c=this.getTable()[0].rows[parseInt(e,10)];if(c){if(d==null){return a(c);}else{if(a.isNumber(d)){if(d>=0&&d<c.cells.length){return a(c.cells[d]);}}else{if(a.isString(d)){var b=parseInt(this.tabHead.get(d),10);
if(b>=0&&b<c.cells.length){return a(c.cells[b]);}}}}}return null;},isPrimary:function(g,f,i){if(g==null||g==""){return false;}var d="";var c="";a.each(g.split(","),function(j,k){c+=f[k];});if(i!=null){var e=this.getRowData(g,i);if(e){d="";a.each(g.split(","),function(j,k){d+=e.get(k);});return c==d;}else{return false;
}}else{var b=this;var h=false;a("#"+this.tabName+" tbody").children().each(function(j,k){var l=b.getRowData(g,j+b.tabHeadSize);d="";if(l){a.each(g.split(","),function(m,n){d+=l.get(n);});}l=null;if(c==d){h=true;return;}});if(h){return true;}}return false;},tableEventMouseUp:function(f){var c=a(f.target).parents("table");
var g=c.data("Wade_Table_SlipStartX")-f.pageX;var b=c.data("Wade_Table_SlipElemnt");a.removeData(c[0],"Wade_Table_SlipElemnt");a.removeData(c[0],"Wade_Table_SlipStartX");a("thead",c).unbind("mouseup",window["Table_"+c.attr("id")].tableEventMouseUp);if(g===0||!b){return;}var d=b.parent().prev();while(d.length&&d.css("display")=="none"){d=d.prev();
}d.css("width",d.width()-g);b.parent().css("width",b.parent().width()+g);document.onselectstart=function(){return true;};},slipTable:function(c){var d=a("#"+c);var b=a("thead th span[class=slip]",d);if(b.length>0){a("thead",d).bind("mousedown",function(f){if(a(f.target).attr("class")!="slip"){a("thead",d).unbind("mouseup",window["Table_"+d.attr("id")].tableEventMouseUp);
}});b.bind("mousedown",function(f){a("thead",d).bind("mouseup",window["Table_"+d.attr("id")].tableEventMouseUp);d.data("Wade_Table_SlipElemnt",a(this));d.data("Wade_Table_SlipStartX",f.pageX);document.onselectstart=function(){return false;};});}}};a.table.fn.construct.prototype=a.table.fn;a.table.get=a.table.fn.get;
}})(Wade);