(function(){if(typeof($.Search)=="undefined"){$.Search=function(f,b,e,c){var d=new $.Search.fn.constructor(f,b,e,c);return d;};function a(h,f){if(!h){return -1;}if($.isString(h)){h=new Array(h);}else{if(h.hasOwnProperty("items")){h=h.items;}}var b=0;var g=h.length;for(var d=0;d<g;d++){title=h[d].toUpperCase();
if(f.indexOf(" ")>0){var e=f.split(" ");for(var j=0;j<e.length;j++){if(e[j]!=""){var c=title.indexOf(e[j]);if(c<0){b=-1;break;}else{if(j==0){b=c;}}}}}else{b=title.indexOf(f);}if(b>=0){break;}}h=null;return b;}$.Search.fn={constructor:function(b,k,i,d){this.id=b;this.pageName=k;this.listenerName=i;var c=$("#"+this.id);
var e=c.attr("clickAction");if(e){this.clickAction=new Function("return "+e+";")();}var g=c.attr("afterAction");if(g){this.afterAction=new Function("return "+g+";")();}var j=c.attr("enterAction");if(j){this.enterAction=new Function("return "+j+";")();}var f=c.attr("keyUpAction");if(f){this.keyUpAction=new Function("return "+f+";")();
}var m=c.attr("keyDownAction");if(m){this.keyDownAction=new Function("return "+m+";")();}var l=c.attr("optionEnterAction");if(l){this.optionEnterAction=new Function("return "+l+";")();}var h=c.attr("optionClickAction");if(h){this.optionClickAction=new Function("return "+h+";")();}$.extend(this,d);},get:function(b){return window["Search_"+b];
},setSearchData:function(b){this.searchData=b;},downLoadedStatusTrue:function(){if(this.dataLoaded==false){this.dataLoaded=true;if(this.nextSearchValue&&this.nextSearchValue!=""){var b=this.nextSearchValue;this.nextSearchValue="";this.beginSearch(b);}}},beginSearch:function(d,f){this.searchPosition=parseInt(this.searchPosition,10);
if(d.length<this.searchPosition){return;}if(!this.dataLoaded){this.nextSearchValue=d;return;}else{this.dataLoaded=false;this.nextSearchValue="";}if($("#Div_Search_"+this.id).css("visibility")!="visible"){var c=$.initPosition($("#"+this.id),this.width);if(!$("#Div_Search_"+this.id)||$("#Div_Search_"+this.id).length<1){this.createOptionHtml(c.topPx,c.leftPx,c.widthPx);
}else{this.updatePosition(c.topPx,c.leftPx,c.widthPx);}}var e=this.id;var b=$.Search.get(e);if(!this.dynamic||this.dynamic=="false"){if(!this.searchData){this.getAjaxData(d,function(){b.updateOptionHtml(b.readMemoryData(d));$.updateTopPos($("#"+e),"Div_Search_"+e);b.showSearch();if(f&&$.isFunction(f)){f.call(b,d);
}});return;}}else{this.getAjaxData(d,function(){b.updateOptionHtml(b.searchData);$.updateTopPos($("#"+e),"Div_Search_"+e);b.showSearch();if(f&&$.isFunction(f)){f.call(b,d);}});return;}if(this.dynamic&&this.dynamic!="false"){this.updateOptionHtml(this.searchData);}else{this.updateOptionHtml(this.readMemoryData(d));
}this.downLoadedStatusTrue();$.updateTopPos($("#"+this.id),"Div_Search_"+this.id);this.showSearch();},showSearch:function(){$("#Div_Search_"+this.id).css("visibility","visible");},hiddenSearch:function(){$("#Div_Search_"+this.id).css("visibility","hidden");},readMemoryData:function(b){if(!b||b==""){return this.searchData;
}var d=new $.DatasetList();if(this.searchData&&b){b=$.trim(b).toUpperCase();var f=[],j,c,h,k;for(var e=0;e<this.searchData.length;e++){var l=-1;var g=this.searchData.get(e);j=g.get(this.searchCode);h=g.get("Search_AllSpell");k=g.get("Search_FirstSpell");if(escape(b).indexOf("%u")<0){l=a(k,b);if(l<0){l=a(h,b);
}}if(l<0){l=a(j,b);}if(l>-1){f.push([e,l]);}}f.sort(function(m,i){return m[1]-i[1];});for(var e=0;e<f.length;e++){d.add(this.searchData.get(f[e][0]));}f=null;}return d;},getAjaxData:function(c,g){if(!this.listenerName&&!this.componentId&&(!this.clazz||!this.method)){alert($.lang["view.web.component.serach.nodatasrc"]);
return;}var e=this.params;if(e&&(e instanceof $.DataMap)&&e.length){e=e.map;}if($.isObject(e)){e=$.param(e);}if(!c){c="";}var b="";if(e){e+="&"+this.searchCode+"="+encodeURIComponent(c);}else{e=this.searchCode+"="+encodeURIComponent(c);}if(this.dynamic&&this.dynamic!="false"){e+="&pagin=nav";e+="&nav_count=1";
e+="&nav_current=0";e+="&nav_pagesize="+this.maxOption;e+="&nav_needcount=true";}var f=this.id;function d(i){var h=i.context;if("0"!=h.x_resultcode){b=new $.DatasetList("");$.Search.get(f).ajaxCallback(c,b,g,true,h.x_resultinfo);}else{b=i.data;b=new $.DatasetList(b);$.Search.get(f).ajaxCallback(c,b,g,false);
}}if(this.clazz&&this.method){$.httphandler.post(this.clazz,this.method,e,d,null,{dataType:"json",simple:true});}else{$.ajax.post((this.pageName?this.pageName:null),this.listenerName,e,(this.componentId?this.componentId:null),d,null,{dataType:"json",simple:true});}},ajaxCallback:function(d,c,f,b,e){this.setSearchData(c);
if(f&&$.isFunction(f)){f(d,b);}else{if(b&&e){alert(e);return;}}this.downLoadedStatusTrue();},setParams:function(b){this.params=b;},updatePosition:function(e,d,c){var b=$("#Div_Search_"+this.id);b.css("top",e+"px");b.css("left",d+"px");b.css("width",c+"px");},createOptionHtml:function(e,d,c){var b=[];
b.push('<div id="Div_Search_'+this.id+'" class="c_option" style="left:'+d+"px; top:"+e+"px; width:"+c+'px;visibility:hidden">');b.push('<div class="c_optionContent">');b.push('<div id="List_Search_'+this.id+'" class="c_list c_list-table c_list-col-1">');b.push('<ul id="Ul_Search_'+this.id+'">');b.push("</ul>");
b.push("</div>");b.push("</div>");b.push('<div class="c_optionShadow" id="Shadow_Search_'+this.id+'"></div>');b.push('<!--[if IE 6]><iframe class="c_optionCover"></iframe><![endif]-->');b.push("</div>");$.appendContextMenu($("#"+this.id),$("#Div_Search_"+this.id),b.join(""),300,"Div_Search_"+this.id);
$(document).bind("click",window["Search_"+this.id].HiddenLayerInDocument());},HiddenLayerInDocument:function(){var b=this.id;return function(f){var d=f.target;var c=$(d).parents("[id="+b+"]");if(d.id!=b&&!(c&&c.length>0)){window["Search_"+b].hiddenSearch();$("#Ul_Search_"+b).html("");}};},updateOptionHtml:function(c){var e=[];
if(!c||c.length==0){e.push('<li><a href="#nogo" class="text"><span>'+$.lang["view.web.comp.search.nodata"]+"</span></a></li>");}var h=this.id;var f=this.searchCode;var b=this.maxOption;var g=this.optionClass;var d=0;c.each(function(k,j){if(j>=b){return false;}d++;e.push("<li searchIndex="+j+" onmouseover=\"$.Search.get('"+h+"').toggleMouseHover($(this),event)\" ");
e.push(" onmouseout=\"$.Search.get('"+h+"').toggleMouseHover($(this),event)\" onclick=\"$.Search.get('"+h+"').optionClickAction($(this))\" ");k.eachKey(function(i,l){e.push(i+"='"+l+"' ");});if(g&&g!=""){e.push(' class="'+g+'"');}e.push('><span class="text"><span>'+k.get(f)+"</span></span></li>");});
$("#Ul_Search_"+this.id).html(e.join(""));},setSearchReturnValue:function(g){if(!g){var b=$("#Ul_Search_"+this.id+" li");var d=b.length;var f=-1;for(var c=0;c<d;c++){var e=$(b[c]).attr("class");if(e.indexOf("focus")!=-1){e=e.replace(/focus/g,"");$(b[c]).attr("class",e);f=c;}}g=$(b[f]);}if(this.valueCode){$("#"+this.valueCode).val(g.attr(this.valueCode));
}$("#"+this.id).val(g.attr(this.searchCode));this.afterAction();this.hiddenSearch();$("#Ul_Search_"+this.id).html("");},toggleMouseHover:function(b,g,d){var j=$("#Ul_Search_"+this.id+" li");var f=j.length;if(f<=0){return;}var e=-1;for(var c=0;c<f;c++){var k=$(j[c]).attr("class");if(k.indexOf("focus")!=-1){k=k.replace(/focus/g,"");
$(j[c]).attr("class",k);e=c;}}if(d==-1){if(e<=0){e=f;}e--;}if(d==1){if(e>=f-1){e=-1;}e++;}if(d==0){e=0;}if(d!=undefined){b=$(j[e]);}if(b&&b.length>0){var h=b.attr("class");if(h&&h.indexOf("focus")!=-1){h=h.replace(/focus/g,"");}else{if(!h||h==""){h="focus";}else{h+=" focus";}}b.attr("class",h);}g=$.event.fix(g);
g.stopPropagation();},selectOption:function(b,c){this.toggleMouseHover(null,c,b);},clickAction:function(d,c){var b=d.val();if(b==this.defaultText){d.val("");}else{if(b&&b!=""){d[0].select();}}},afterAction:function(){return true;},optionClickAction:function(c,b){this.setSearchReturnValue(c);},enterAction:function(c,b){return true;
},optionEnterAction:function(c,b){this.setSearchReturnValue();b.preventDefault();b.stopPropagation();},keyDownAction:function(c,b){if(this.fromKeyDown){this.loopKeyDown=true;}this.fromKeyDown=true;if(this.loopKeyDown){this.loopKeyDown=false;this.keyUpAction(c,b);}return true;},keyUpAction:function(f,d){this.fromKeyDown=false;
var d=$.event.fix(d);if(d.which==38){var c=$("#Ul_Search_"+this.id+" li");if(c&&c.length>0){this.selectOption(-1,d);}return true;}else{if(d.which==40){var c=$("#Ul_Search_"+this.id+" li");if(c.length<=0){var g=this.id;this.beginSearch(f.val(),function(){$.Search.get(g).selectOption(1,d);});return true;
}this.selectOption(1,d);return;}else{if(d.which==13){var e=$("#Div_Search_"+this.id).css("visibility");var b=$("#Ul_Search_"+this.id+" li[class=focus]");if("hidden"!=e&&b&&b.length>0){this.optionEnterAction(f,d);}else{this.enterAction(f,d);}return false;}}}if(this.previousSearchData==""&&f.val()!=""||this.previousSearchData!=""&&this.previousSearchData!=f.val()){this.previousSearchData=f.val();
this.beginSearch(f.val());}},dynamic:false,searchCode:"Key",valueCode:undefined,searchPosition:0,width:155,maxOption:20,dataLoaded:true,nextSearchValue:"",defaultText:"",previousSearchData:"",optionClass:"",componentId:undefined,fromKeyDown:false,loopKeyDown:false};$.Search.fn.constructor.prototype=$.Search.fn;
$.Search.get=$.Search.fn.get;}})();