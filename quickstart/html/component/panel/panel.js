(function($){if(typeof($.panel)=="undefined"){$.panel=function(id){return new $.panel.fn.construct(id);},$.panel.fn={construct:function(id){this.id=id;this.init();},init:function(){var panelId=this.id;var panel=$("#"+panelId);var inited=panel.data("inited");if(!inited){var f_ac=-1;panel.children("[x_panel_type]").each(function(idx){$.attr(this,"idx",idx);
$.attr(this,"class","c_acc");if("true"==$.attr(this,"keepOpen")){$.attr(this,"active","true");f_ac=idx;}else{if("true"==panel.attr("openAll")){$.attr(this,"active","true");}else{if("true"==panel.attr("closeAll")){$.attr(this,"active","false");}else{if("true"==$.attr(this,"active")){f_ac=idx;}}}}if($.attr(this,"x_panel_type")=="iframe"){var subFrame=$("#"+panelId+" [idx="+idx+"] iframe");
if(subFrame){subFrame.bind("load",$.panel.fn.events.onIframeLoad);var ld_id="x-panel-ld_"+($.guid++);$.insertHtml("afterend",subFrame,'<div id="'+ld_id+'" class="c_tabLoading" style="height:'+subFrame.height()+'px;display:none;"><span><i class="e_ico-loading"></i>'+$.lang["view.web.jcl.tapestry.page.loading"]+"</span></div>");
subFrame.data("ld_id",ld_id);}}if($.attr(this,"x_panel_type")=="content"){var classCount=0;var ct_content=$(this).find("div[x_panle_ct=content]:first");var c_class=ct_content.children(".c_tree,.c_msg,.c_article,.c_form-text");if(c_class!=undefined&&c_class.length>0){classCount+=c_class.length;}var c_list=ct_content.children(".c_list");
if(c_list!=undefined&&c_list.length>0){c_list.each(function(){if(c_list.attr("class").indexOf("c_list-table")==-1){classCount++;}});}if(classCount>1){ct_content.addClass("c_accContent-mix");}}var titleFn=$.attr(this,"titleFn");if(titleFn!=undefined&&titleFn!=""){$(this).find("a[x_panle_ct=title]:first").removeClass("e_center");
var c_fn=$(this).find("div[class=fn]:first");var fnObj=$("#"+titleFn);if(fnObj){fnObj.children().each(function(idx){c_fn.append($(this).clone(true));});fnObj.remove();}}else{$(this).find("a[x_panle_ct=title]:first").addClass("e_center");}});panel.find("a[x_panle_ct=title]").bind("click",$.panel.fn.events.onPanelTitleClick);
panel.data("inited",true);panel.data("active_idx",f_ac);if("true"==panel.attr("openAll")){panel.attr("showScroll","true");}if("false"==panel.attr("openAll")&&"true"==panel.attr("closeAll")){return;}this.refreshPanel(true);}},switchTo:function(title,active){if(!title||!$.isString(title)){return;}if(active==undefined){active=true;
}var el=$("#"+this.id+" [panel_title='"+title+"']:first");var idx=el.attr("idx");var c_panel=$("#"+this.id);var pidx=c_panel.data("active_idx");if(pidx==idx){return;}if("true"==el.attr("keepOpen")){return;}if("true"==c_panel.attr("openAll")){el.attr("active",!("true"==el.attr("active"))+"");c_panel.data("active_idx",-1);
}else{c_panel.children("[x_panel_type]").each(function(c_idx){if("true"==$.attr(this,"active")&&"false"==$.attr(this,"keepOpen")){$.attr(this,"active","false");}});el.attr("active","true");c_panel.data("active_idx",idx);}this.refreshPanel();},switchToByIdx:function(idx,active,height){var panel=$("#"+this.id);
var item=$("#"+this.id+" [idx="+idx+"]");if(!item){return;}if(active){var ct_content=item.find("div[x_panle_ct=content]:first");if("false"==panel.attr("showScroll")&&height&&height>0){ct_content.attr("style","height:"+height+"px;");if(ct_content.height()>height){ct_content.addClass("c_scroll");}}else{ct_content.attr("style","height:"+ct_content.attr("height")+"px;");
ct_content.removeClass("c_scroll");}item.attr("active","true");item.attr("class","c_acc c_acc-on");if(item.attr("x_panel_type")=="iframe"){var subFrame=$("#"+this.id+" [idx="+idx+"] iframe");if(!subFrame){return;}var inited=subFrame.data("inited");var fresh=subFrame.attr("fresh");if(!inited||fresh=="true"){var page=subFrame.attr("page");
var listener=subFrame.attr("listener");var params=subFrame.attr("params");var subsys=subFrame.attr("subsys");var url;var p="";if(params!=null&&params!=""){if(params.search(/[\"|\']\+\s*[\$]\(/)!=-1||params.search(/[\"|\']\+\s*(document.getElement)/)!=-1){params=eval(params);}$.each(params.split("&"),function(idx,item){var index=item.indexOf("=");
if(index!=-1){p+="&"+item.substring(0,index)+"="+encodeURIComponent(item.substring(index+1));}else{p+="&"+item+"=";}});}else{p=null;}if(subsys){url=$.redirect.buildUrl(subsys,page,listener,p);}else{url=$.redirect.buildUrl(page,listener,p);}subFrame.attr("src",url);subFrame.data("inited",true);}}else{if($.resizeHeight){$.resizeHeight();
}}}else{item.attr("active","false");item.attr("class","c_acc");}},get:function(name){return window["Panel_"+name];},getCurrentTitle:function(){var idx=$("#"+this.id).data("active_idx");if(/^\d+$/.test(idx)){return $("#"+this.id+" [idx="+idx+"]").attr("panel_title");}},getCurrentContentWindow:function(){var idx=$("#"+this.id).data("active_idx");
if(/^\d+$/.test(idx)){var el=$("#"+this.id+" [idx="+idx+"]");if(el.attr("x_panel_type")=="iframe"){return $("#"+this.id+" [idx="+idx+"] iframe:first")[0].contentWindow;}}},getContentWindow:function(title){if(!title||!$.isString(title)){return;}var el=$("#"+this.id+" [panel_title='"+title+"']:first");
if(el.attr("x_panel_type")=="iframe"){return el.find("iframe:first")[0].contentWindow;}},getAllPanelTitle:function(){var title=[];$("#"+this.id).children("[x_panel_type]").each(function(idx,item){title[idx]=$.attr(this,"panel_title");});return title;},addPanelContent:function(title,siteIndex,html,titleFn,isActive,isKeepOpen,height){if(!title||!$.isString(title)){return;
}if(!html||!$.isString(html)){return;}this.addPanelItem("PanelContent",title,siteIndex,titleFn,html,null,isActive,isKeepOpen,height);},addPanelFrame:function(title,siteIndex,titleFn,page,listener,params,subsys,isActive,isKeepOpen,height){if(!title||!$.isString(title)){return;}if(!page||!$.isString(page)){return;
}var paramsArray=[];var frameParams=null;paramsArray.push(' page="');paramsArray.push(page);paramsArray.push('" ');if(listener&&$.isString(listener)){paramsArray.push(' listener="');paramsArray.push(listener);paramsArray.push('" ');}if(params&&$.isString(params)){paramsArray.push(' params="');paramsArray.push(params);
paramsArray.push('" ');}if(subsys&&$.isString(subsys)){paramsArray.push(' subsys="');paramsArray.push(subsys);paramsArray.push('" ');}if(paramsArray.length>0){frameParams=paramsArray.join("");}this.addPanelItem("PanelFrame",title,siteIndex,titleFn,null,frameParams,isActive,isKeepOpen,height);},addPanelItem:function(itemType,title,siteIndex,titleFn,htmlId,params,isActive,isKeepOpen,height){if(!title||!$.isString(title)){return;
}var xPanelType="";if(itemType=="PanelContent"){xPanelType="content";}else{if(itemType=="PanelFrame"){xPanelType="iframe";}}var idx=$("#"+this.id).children("[x_panel_type]").length;var panelConent=[];panelConent.push('<div x_panel_type="'+xPanelType+'" class="c_acc" panel_title="'+title+'" ');if(titleFn&&$.isString(titleFn)&&titleFn!=""){panelConent.push('titleFn="'+titleFn+'" ');
}if(isKeepOpen){panelConent.push('keepOpen="'+isKeepOpen+'" ');isActive=true;}else{panelConent.push('keepOpen="false" ');}panelConent.push('active="'+isActive+'" ');if(itemType=="PanelContent"){panelConent.push(params);}panelConent.push(' idx="'+idx+'">\n\t');panelConent.push('<div class="c_accTitle">\n\t\t');
panelConent.push('<a x_panle_ct="title" href="#nogo" class="text');if(titleFn&&$.isString(titleFn)&&titleFn!=""){panelConent.push('">'+title+"</a>\n\t");panelConent.push('\t<div class="fn"></div>');}else{panelConent.push(' e_center">'+title+"</a>\n\t");}panelConent.push('</div>\n\t<div x_panle_ct="content" class="c_accContent"');
var styleArray=[];if(height!=null&&""!=height){styleArray.push("height:");styleArray.push(height);styleArray.push(";");}if(styleArray.length>0){panelConent.push(' style="'+styleArray.join("")+'"');}panelConent.push(' height="'+height+'"');panelConent.push(">\n\t");if(itemType=="PanelFrame"){panelConent.push('<iframe id="F-PanelFrame-'+idx+'" name="F-PanelFrame-'+idx+'" frameborder="no" ');
panelConent.push('style="width:100%;height:100%;display:none;" '+params+"></iframe>");}panelConent.push("\n\t</div>\n</div>");if(/^\d+$/.test(siteIndex)){if(siteIndex==0){$.insertHtml("afterbegin",$("#"+this.id),panelConent.join(""));}else{$.insertHtml("beforebegin",$("#"+this.id).children("[x_panel_type]")[siteIndex],panelConent.join(""));
}}else{$.insertHtml("beforeend",$("#"+this.id),panelConent.join(""));}var newChild=$("#"+this.id+" [idx="+idx+"]");newChild.find("a[x_panle_ct=title]:first").bind("click",$.panel.fn.events.onPanelTitleClick);if(titleFn&&$.isString(titleFn)&&titleFn!=""){var c_fn=newChild.find("div[class=fn]:first");var fnObj=$("#"+titleFn);
if(fnObj){fnObj.children().each(function(idx){c_fn.append($(this).clone(true));});fnObj.remove();}}if(itemType=="PanelContent"){var classCount=0;var ct_content=newChild.find("div[x_panle_ct=content]:first");var htmlObj=$("#"+htmlId);if(htmlObj){var content=htmlObj.clone(true);htmlObj.remove();ct_content.append(content);
}var c_class=ct_content.children(".c_tree,.c_msg,.c_article,.c_form-text");if(c_class!=undefined&&c_class.length>0){classCount+=c_class.length;}var c_list=ct_content.children(".c_list");if(c_list!=undefined&&c_list.length>0){c_list.each(function(){if(c_list.attr("class").indexOf("c_list-table")==-1){classCount++;
}});}if(classCount>1){ct_content.addClass("c_accContent-mix");}}else{if(itemType=="PanelFrame"){var subFrame=$("#"+this.id+" [idx="+idx+"] iframe");if(subFrame){subFrame.bind("load",$.panel.fn.events.onIframeLoad);var ld_id="x-panel-ld_"+($.guid++);var frameHeight="";if(height!=null&&""!=height){frameHeight=height;
}$.insertHtml("afterend",subFrame,'<div id="'+ld_id+'" class="c_tabLoading" style="height:'+frameHeight+';display:none;"><span><i class="e_ico-loading"></i>'+$.lang["view.web.jcl.tapestry.page.loading"]+"</span></div>");subFrame.data("ld_id",ld_id);}}}if(isActive){$("#"+this.id).data("active_idx",idx);
}this.refreshPanel();},refreshPanel:function(isInit){var panelId=this.id;var panel=$("#"+panelId);var items=panel.children("[x_panel_type]");if(!items||items.length<1){return;}var activeIdxs=[];var hasFn=false;var fnItems=$("#"+panelId+" div[titleFn]:not('')");if(fnItems&&fnItems.length>0){hasFn=true;
}items.each(function(idx){if(hasFn){$(this).find("a[x_panle_ct=title]:first").removeClass("e_center");}else{$(this).find("a[x_panle_ct=title]:first").addClass("e_center");}if("true"==$.attr(this,"active")){activeIdxs.push($.attr(this,"idx"));}$.attr(this,"class","c_acc");});if("true"==panel.attr("openAll")){panel.attr("showScroll",true);
for(var i=0;i<activeIdxs.length;i++){if(activeIdxs[i]!=""){this.switchToByIdx(activeIdxs[i],true);}}panel.data("active_idx",-1);}else{var f_ac=panel.data("active_idx");var keepItems=panel.children("[keepOpen=true]");var activeHeight=panel.height()-$("#"+this.id+" [idx=0]").height()*items.length;var curHeight=activeHeight;
var prevHeight=null;if(isInit){if(f_ac<0&&items.length>0){f_ac=0;activeIdxs.push(f_ac);}}else{activeIdxs=[];if(f_ac>-1){activeIdxs.push(f_ac);}if(keepItems&&keepItems.length>0){keepItems.each(function(index){if($.attr(this,"idx")!=f_ac){activeIdxs.push($.attr(this,"idx"));}});}}prevHeight=Math.floor(activeHeight/activeIdxs.length);
if("true"==panel.attr("showScroll")){curHeight=null;prevHeight=null;}else{curHeight=activeHeight-prevHeight*(activeIdxs.length-1);}for(var i=0;i<activeIdxs.length;i++){if((activeIdxs[i]+"")!=""){if(i==activeIdxs.length-1){this.switchToByIdx(activeIdxs[i]+"",true,curHeight);}else{this.switchToByIdx(activeIdxs[i]+"",true,prevHeight);
}}}panel.data("active_idx",f_ac);}this.refreshScroll(panelId);},refreshScroll:function(panelId){var panel=$("#"+panelId);var items=panel.children("[x_panel_type]");if(!items||items.length<1){return;}if("true"==panel.attr("showScroll")){var totalHeight=0;items.each(function(idx){totalHeight+=panel.find("[idx="+$.attr(this,"idx")+"]").height();
});if(totalHeight>panel.height()){panel.addClass("c_scroll");}else{panel.removeClass("c_scroll");}}},setOpenAll:function(isOpenAll){$("#"+this.id).attr("openAll",isOpenAll+"");this.showScroll(isOpenAll);if(isOpenAll){$("#"+this.id).children("[x_panel_type]").each(function(idx){$.attr(this,"active","true");
});}},setKeepOpen:function(title,value){if(!title||!$.isString(title)){return;}var el=$("#"+this.id+" [panel_title='"+title+"']:first");el.attr("keepOpen",value+"");},showScroll:function(value){$("#"+this.id).attr("showScroll",value+"");},showIframeContent:function(ifrEl){var userDefinedWade_hasEdgeBetweenPage=window["Wade_hasEdgeBetweenPage"];
var userDefinedWade_isStopResizeHeight=window["Wade_isStopResizeHeight"];window["Wade_hasEdgeBetweenPage"]=false;window["Wade_isStopResizeHeight"]=false;if(ifrEl.contentWindow["resizeHeight"]){ifrEl.contentWindow.resizeHeight();}window["Wade_hasEdgeBetweenPage"]=userDefinedWade_hasEdgeBetweenPage;window["Wade_isStopResizeHeight"]=userDefinedWade_isStopResizeHeight;
$.data(ifrEl,"loaded",true);var panel=$(ifrEl).parents("div[x_panel]");var panelId=panel.attr("id");this.refreshScroll(panelId);var ld_id=$.data(ifrEl,"ld_id");$("#"+ld_id).css("display","none");$(ifrEl).css("display","");},events:{onPanelTitleClick:function(e){var c_content=$(this).parents("div[x_panel_type]");
var c_panel=c_content.parents("div[x_panel]");var idx=c_content.attr("idx");var id=c_panel.attr("id");var pidx=c_panel.data("active_idx");if(pidx==idx){return;}var el=$("#"+id+" [idx="+idx+"]");var p_el=$("#"+id+" [idx="+pidx+"]");var ptitle=p_el.attr("panel_title");var title=el.attr("panel_title");var isKeepOpen=false;
if("true"==el.attr("keepOpen")){isKeepOpen=true;}if(window["Panel_"+id].switchAction&&$.isFunction(window["Panel_"+id].switchAction)){if(window["Panel_"+id].switchAction(ptitle,title)===false){return;}}if("true"==el.attr("keepOpen")){return;}if("true"==c_panel.attr("openAll")){el.attr("active",!("true"==el.attr("active"))+"");
c_panel.data("active_idx",-1);}else{if(isKeepOpen){el.attr("active","false");}else{el.attr("active","true");p_el.attr("active","false");c_panel.data("active_idx",idx);}}window["Panel_"+id].refreshPanel();},onIframeLoad:function(e){$.panel.fn.showIframeContent(this);}}};$.panel.fn.construct.prototype=$.panel.fn;
$.panel.get=$.panel.fn.get;}})(Wade);