/*!
 * PopupBox
 * http://www.wadecn.com/
 * auth:xiedx@asiainfo.com
 * Copyright 2015, WADE
 */
!function(e,a,i){"use strict";function t(e,a){if(e&&e.nodeType&&a)return e.currentStyle?e.currentStyle[a]:i.defaultView.getComputedStyle(e,!1)[a]}if(e&&"undefined"==typeof e.PopupBox){var p=Array.prototype.push,n=Array.prototype.splice,o="undefined"!=typeof e.hasTouch?e.hasTouch:"ontouchstart"in a,r=o?"touchstart":"mousedown",s=null,d=[],u=0,l=function(){var a,i=e.getParentIframe();return i&&parent.Wade&&parent.Wade.PopupBox&&(a=parent.Wade.PopupBox.findPopup(i)),a&&(s=i),a},c=function(t){if(t){var p=e.Popup&&e.isFunction(e.Popup)&&e.Popup.prototype._init,n=e.Dialog&&e.isFunction(e.Dialog)&&e.Dialog.prototype._init;if(e.isString(t)&&a[t]&&(p&&a[t]instanceof e.Popup||n&&a[t]instanceof e.Dialog))return a[t];if(t.nodeType)for(var o,r,s=0,d=t.parentNode;s<50&&d&&d.nodeType&&d!=i.body;){if(e.nodeName(d,"div")&&(r=" "+d.className+" ")&&(r.indexOf(" c_popup ")>-1||r.indexOf(" c_dialog ")>-1)&&(o=e.attr(d,"id"))&&a[o]&&(p&&a[o]instanceof e.Popup||n&&a[o]instanceof e.Dialog))return a[o];d=d.parentNode,s++}}},f=function(e){var a;return s=null,(a=c(e))?a:l()},h={findPopup:function(e){return f(e)},showPopup:function(e,a,i){var t=f(e);t&&t.show(a,i)},hidePopup:function(e){var a=f(e);a&&a.hide()},forwardPopup:function(i,t,p,n,o,r){var d=f(i);if(d)if(arguments.length<3)d.forward(s||i,t);else{var u=t;if(!(i&&i.nodeType&&u&&e.isString(u)&&p&&e.isString(p)))return;e.Frame||a.includeScript(e.UI_FRAME_JS,!0,!0);var l=d.append(s||i,u),c="frame_"+l;d.getFrame(c).reset(p,n,o,r,u),d.forward(s||i,l),l=c=null}},backPopup:function(e,a,i,t){var p=f(e);return!!p&&(p.back(s||e,a,i,t),!0)},popupPage:function(t,p,n,o,r,s,d,u,l){if(e.isSameDomain(parent)&&!e.isSamePage(parent)&&!0!==parent.StopPopupRecursion&&parent.Wade&&(parent.Wade.Popup||parent.Wade.Dialog||parent.Wade.Tabset)){var c,f,h=e.getParentIframe();if(h&&((c=e.attr(h,"popupId"))&&parent[c]&&(parent.Wade.Popup&&parent[c]instanceof parent.Wade.Popup||parent.Wade.Dialog&&parent[c]instanceof parent.Wade.Dialog)||(f=e.attr(h,"tabsetId"))&&parent[f]&&parent.Wade.Tabset&&parent[f]instanceof parent.Wade.Tabset))return void parent.popupPage(t,p,n,o,r,s,d,u,a)}if(t&&e.isString(t)&&p&&e.isString(p)){e.Popup||a.includeScript(e.UI_POPUP_JS,!0,!0),e.Frame||a.includeScript(e.UI_FRAME_JS,!0,!0),e.isFunction(s)&&(u=d,d=s,s=null),t=e.xss(t);var g,v=e.md5("popup_"+t);if(g=a["popup_"+v]){if(!0!==g.visible){var _=a["frame_"+v].reset(p,n,o,r,t);g.show(1,_)}}else{s?"half"==s?s="c_popup c_popup-half":"full"==s&&(s="c_popup c_popup-full"):s="c_popup";var m=[];m.push('<div id="popup_'+v+'" class="'+s+'">'),m.push('<div class="c_popupBg"></div>'),m.push('<div class="c_popupBox">'),m.push('<div class="c_popupWrapper">'),m.push('<div id="popup_'+v+'_group1" class="c_popupGroup" level="1">'),m.push('<div class="c_popupItem">'),m.push('<iframe id="frame_'+v+'" style="width:100%;height:100%;display:none" frameborder="0"></iframe>'),m.push('<div class="c_msg c_msg-full c_msg-loading">'),m.push('<div class="wrapper">'),m.push('<div class="emote"></div>'),m.push('<div class="info"><div class="text"><div class="title">loading</div></div></div>'),m.push("</div>"),m.push("</div>"),m.push("</div>"),m.push("</div>"),m.push("</div>"),m.push("</div>"),e(i.body).append(m.join("")),m=null,d&&(e.isFunction(d)?e("#popup_"+v).afterAction(d):e.isString(d)&&e("#popup_"+v).attr("onafterAction",d)),u&&(e.isFunction(u)?e("#popup_"+v).hideAction(u):e.isString(u)&&e("#popup_"+v).attr("onhideAction",u)),a["frame_"+v]=new Wade.Frame("frame_"+v,{autoInit:!1,title:t,page:p,listener:n,params:o,subsys:r}),g=a["popup_"+v]=new Wade.Popup("popup_"+v,{visible:!1,mask:!0,srcWindow:l}),g.show(1)}return g}},popupDialog:function(t,p,n,o,r,s,d,u,l,c,f){if(e.isNumeric(r)&&(c=l,l=u,u=d,d=s,s=r,r=null),e.isFunction(u)&&(l=u,c=l,u=!0),e.isSameDomain(parent)&&!e.isSamePage(parent)&&!0!==parent.StopPopupRecursion&&parent.Wade&&(parent.Wade.Popup||parent.Wade.Dialog||parent.Wade.Tabset)){var h,g,v=e.getParentIframe();if(v&&((h=e.attr(v,"popupId"))&&parent[h]&&(parent.Wade.Popup&&parent[h]instanceof parent.Wade.Popup||parent.Wade.Dialog&&parent[h]instanceof parent.Wade.Dialog)||(g=e.attr(v,"tabsetId"))&&parent[g]&&parent.Wade.Tabset&&parent[g]instanceof parent.Wade.Tabset))return void parent.popupDialog(t,p,n,o,r,s,d,u,l,c,a)}if(t&&e.isString(t)&&p&&e.isString(p)){e.Dialog||a.includeScript(e.UI_DIALOG_JS,!0,!0),e.Frame||a.includeScript(e.UI_FRAME_JS,!0,!0),t=e.xss(t);var _,m=e.md5("dialog_"+t);if(_=a["dialog_"+m]){if(!0!==_.visible){a["frame_"+m].reset(p,n,o,r,t);_.show()}}else{e.isNumeric(s)&&(s+="em"),e.isNumeric(d)&&(d+="em");var y=[];y.push('<div id="dialog_'+m+'" class="c_dialog" style="display:none;">'),y.push('<div class="wrapper">'),y.push('<div class="header">'),y.push('<div class="text">'+t+"</div>"),y.push('<div class="fn">'),y.push('<div class="close"></div>'),y.push("</div>"),y.push("</div>"),y.push('<div class="content">'),y.push('<iframe id="frame_'+m+'" style="width:100%;height:100%;display:none" frameborder="0"></iframe>'),y.push('<div class="c_msg c_msg-full c_msg-loading">'),y.push('<div class="wrapper">'),y.push('<div class="emote"></div>'),y.push('<div class="info"><div class="text"><div class="title">loading</div></div></div>'),y.push("</div>"),y.push("</div>"),y.push("</div>"),y.push("</div>"),e(i.body).append(y.join("")),y=null,l&&(e.isFunction(l)?e("#dialog_"+m).afterAction(l):e.isString(l)&&e("#dialog_"+m).attr("onafterAction",l)),c&&(e.isFunction(c)?e("#dialog_"+m).hideAction(c):e.isString(c)&&e("#dialog_"+m).attr("onhideAction",c)),a["frame_"+m]=new Wade.Frame("frame_"+m,{autoInit:!1,title:t,page:p,listener:n,params:o,subsys:r}),_=a["dialog_"+m]=new Wade.Dialog("dialog_"+m,{closeable:0!=u,height:d,width:s,srcWindow:f}),_.show()}return _}},setPopupReturnValue:function(e,a,i,t){var p=f(e);p&&p.setPopupReturnValue(a,i,t)},showFloatLayer:function(a,t){if(a&&e.isString(a)&&(a=i.getElementById(a)),a&&a.nodeType){var n=e.attr(a,"id");n||(n="_floatLayer_"+ ++u,e.attr(a,"id",n));var o=a.className?a.className:"";if((" "+o+" ").indexOf(" c_float ")>-1){if((" "+o+" ").indexOf(" c_float-show ")>-1)return;a.className=e.trim(o+" c_float-show")}else{var r=t&&e.isString(t)?t:"";if(a.style.display==r)return;a.style.display=r}a.style.zIndex=e.zIndexer.get(n),p.call(d,n)}},hideFloatLayer:function(a){if(a&&e.isString(a)&&(a=i.getElementById(a)),a&&a.nodeType){var t=e.attr(a,"id");if(t){var p=a.className?a.className:"";if((" "+p+" ").indexOf(" c_float ")>-1){if((" "+p+" ").indexOf(" c_float-show ")<0)return;a.className=e.trim((" "+p+" ").replace(/ c_float-show /g," "))}else{if("none"==a.style.display)return;a.style.display="none"}e.zIndexer.remove(t),n.call(d,e.inArray(t,d),1)}}},toggleFloatLayer:function(a,p){if(a&&e.isString(a)&&(a=i.getElementById(a)),a&&a.nodeType){var n=a.className?a.className:"";((" "+n+" ").indexOf(" c_float ")>-1?(" "+n+" ").indexOf(" c_float-show ")>-1:"none"!=t(a,"display"))?h.hideFloatLayer(a):h.showFloatLayer(a,p)}}};e(function(){e(i.body).bind(r,function(a){if(a&&a.target){var t=a.target;if(t&&t.nodeType&&!(d.length<=0)){for(var p=0,n=!1;t&&t.nodeType&&t!=i.body&&p<50;){var o=e.attr(t,"id"),r=e.attr(t,"x-wade-float");if(r&&e.inArray(r,d)==d.length-1){n=!0;break}if(o&&e.inArray(o,d)==d.length-1&&"none"!=t.style.display){n=!0;break}t=t.parentNode,p++}n||h.hideFloatLayer(d[d.length-1])}}})}),e.PopupBox=h,e.each("showPopup,hidePopup,forwardPopup,backPopup,popupPage,popupDialog,setPopupReturnValue,showFloatLayer,hideFloatLayer,toggleFloatLayer".split(","),function(i,t){a[t]=e.PopupBox[t]})}}(window.Wade,window,document);