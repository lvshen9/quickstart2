/*!
 * popup component
 * http://www.wadecn.com/
 * auth:xiedx@asiainfo.com
 * Copyright 2015, WADE
 */
!function(e,t,i){"use strict";function n(e){return""===r?e:(e=e.charAt(0).toUpperCase()+e.substr(1),r+e)}if(e&&"undefined"==typeof e.Popup){var s=(Math,i.createElement("div").style),r=function(){for(var e="t,webkitT,MozT,msT,OT".split(","),t=0,i=e.length;t<i;t++)if(e[t]+"ransform"in s)return e[t].substr(0,e[t].length-1);return!1}(),l=r?"-"+r.toLowerCase()+"-":"",a=n("transform"),o=n("transitionProperty"),p=n("transitionDuration"),u=(n("transformOrigin"),n("transitionTimingFunction")),d=(n("transitionDelay"),n("perspective")in s),f=("undefined"!=typeof e.hasTouch&&e.hasTouch,!1!==r),c=(n("transition"),function(){return!1!==r&&{"":"transitionend",webkit:"webkitTransitionEnd",Moz:"transitionend",O:"otransitionend",ms:"MSTransitionEnd"}[r]}()),m=d?" translateZ(0)":"";s[a]=m;var v=Array.prototype.push,y=Array.prototype.splice,h=e.os.phone||!0===e.ratioPhone,b=Math.round(2857)/100,w=/^[1-9]{1}$/,g=/^[1-9]{1}$/,x=[],_=function(t,n){var s=this;s.el=t&&1==t.nodeType?t:i.getElementById(t),s.el&&s.el.nodeType&&(s.id=e.attr(s.el,"id"))&&(n&&e.isObject(n)&&e.extend(s,n),e.attr(s.el,"x-wade-uicomponent")||e.attr(s.el,"x-wade-uicomponent","popup"),s._init(),s.constructor.call(s))};_.prototype=e.extend(new e.UIComponent,{handleEvent:function(e){var t=this;switch(e.type){case c:t._transitionEnd(e)}},show:function(i,n){var s=this;if(!0!==s.visible||n){if(!0!==s.visible&&!0!==s.mask&&!0!==s.overlap){var r;e.each(x,function(e,i){i!=s.id&&(r=t[i],1==r.visible&&r.mask==s.mask&&r.hide())})}var p=e("div[visible-snapshot=true]",s.el);p.attr("visible",!0),p.attr("visible-snapshot",!1),f?p.css("visibility","visible"):p.css("display",""),p=null,!1!==n&&(s.reset(),s._showItem(1,i),s._itemPath=[i]),s.el.style.zIndex=e.zIndexer.get(s.id),s.el.style.visibility="visible",f&&setTimeout(function(){s.el.style[o]=l+"transform",s.el.style[a]="translate(0,0)"+m},1),s.visible=!0,s.mask}},hide:function(){var t=this;if(!1!==t.visible&&!1!==e.event.trigger("hideAction",null,t.el)){if(e.zIndexer.remove(t.id),f)setTimeout(function(){t.el.style[o]=l+"transform",t.el.style[a]="translate(100%,0)"+m},1);else{t.el.style.visibility="hidden";var i=e("div[visible=true]",t.el);i.attr("visible",!1),i.attr("visible-snapshot",!0),i.css("display","none"),i=null}t.visible=!1}},reset:function(){var e=this,t=!0===e.visible?l+"transform":"none";e.isFull?f?(e.wrapper.style[o]=t,e.wrapper.style[a]="translate(0,0)"+m):e.wrapper.style.marginLeft="":e.isHalf?f?e.isHalfBg?(e.box.style[o]=l+"transform",e.box.style[a]="translate(0,0)"+m):(e.el.style[o]=l+"transform",e.el.style[a]="translate(0,0)"+m):(e.el.style.left="",e.wrapper.style.marginLeft=""):h?f?(e.wrapper.style[o]=t,e.wrapper.style[a]="translate(0,0)"+m):e.wrapper.style.marginLeft="":f?(e.box.style[o]=t,e.box.style[a]="translate(0,0) "+m):e.box.style.left=b+"em",e.level=1},forward:function(t,i){var n=this,s=null;t&&t.nodeType&&(s=O(t),parseInt(e.attr(s,"level")));var r=null,p=null;if(s)for(var u=0,d=s.nextSibling;u<20&&d;){if(d.nodeType&&e.nodeName(d,"div")&&(" "+d.className+" ").indexOf(" c_popupGroup ")>-1){r=d,p=parseInt(e.attr(d,"level"));break}d=d.nextSibling,u++}else p=n.level+1,r=n._findGroup(p);if(!(p>8)&&r){if(undefined==i&&(i=1),n._showItem(r,i),n.isFull)f?setTimeout(function(){n.wrapper.style[o]=l+"transform",n.wrapper.style[a]="translate(-"+12.5*(p-1)+"%,0)"+m},1):n.wrapper.style.marginLeft="-"+100*(p-1)+"%";else if(n.isHalf)f?h?setTimeout(function(){n.wrapper.style[o]=l+"transform",n.wrapper.style[a]="translate(-"+12.5*(p-1)+"%,0)"+m},1):(n.isHalfBg?2==p&&setTimeout(function(){n.box.style[o]=l+"transform",n.box.style[a]="translate(-50%,0)"+m},1):2==p&&setTimeout(function(){n.el.style[o]=l+"transform",n.el.style[a]="translate(-50%,0)"+m},1),p>=3&&setTimeout(function(){n.wrapper.style[o]=l+"transform",n.wrapper.style[a]="translate(-"+12.5*(p-2)+"%,0)"+m},1)):(n.isHalfBg?2==p&&(n.box.style.left="0"):2==p&&(n.el.style.left="0"),p>=3&&(n.wrapper.style.marginLeft="-"+50*(p-2)+"%"));else{h||2!=p||(f?setTimeout(function(){n.box.style[o]=l+"transform",n.box.style[a]="translate(-"+b+"em,0)"+m},1):n.box.style.left="0");var c=h?2:3;p>=c&&(f?setTimeout(function(){n.wrapper.style[o]=l+"transform",n.wrapper.style[a]="translate(-"+b*(p-c+1)+"em,0)"+m},1):n.wrapper.style.marginLeft="-"+b*(p-c+1)+"em")}n.level=p,n._itemPath[n.level-1]=i}},back:function(t,i,n,s){var r=this;e.isObject(i)&&(s=n,n=i,i=null);var p=r.level-1;if(p<1)return void r.hide();var u=null;if(t&&t.nodeType&&(u=O(t),parseInt(e.attr(u,"level"))),u){for(var i,t,d,c=u.childNodes,v=0;v<c.length;)t=c[v],1==t.nodeType&&e.nodeName(t,"div")&&(d=t.className?t.className:"",(" "+d+" ").indexOf(" c_popupItem ")>-1&&(" "+d+" ").indexOf(" c_popupItem-show ")>-1&&(t.className=e.trim((" "+d+" ").replace(/ c_popupItem-show /g," ")))),v++;t=d=null,i=c=null}var w=r._findGroup(p);if(w){i||(i=r._itemPath[p-1]);var g=r._showItem(w,i);if(r.isFull)f?setTimeout(function(){r.wrapper.style[o]=l+"transform",r.wrapper.style[a]="translate(-"+12.5*(p-1)+"%,0)"+m},1):r.wrapper.style.marginLeft="-"+100*(p-1)+"%";else if(r.isHalf)f?h?setTimeout(function(){r.wrapper.style[o]=l+"transform",r.wrapper.style[a]="translate(-"+12.5*(p-1)+"%,0)"+m},1):1==p?r.isHalfBg?setTimeout(function(){r.box.style[o]=l+"transform",r.box.style[a]="translate(0,0)"+m},1):setTimeout(function(){r.el.style[o]=l+"transform",r.el.style[a]="translate(0,0)"+m},1):p>=2&&setTimeout(function(){r.wrapper.style[o]=l+"transform",r.wrapper.style[a]="translate(-"+12.5*(p-2)+"%,0)"+m},1):1==p?r.isHalfBg?r.box.style.left="":r.el.style.left="":p>=2&&(r.wrapper.style.marginLeft="-"+50*(p-2)+"%");else{h||1!=p||(f?setTimeout(function(){r.box.style[o]=l+"transform",r.box.style[a]="translate(0,0) "+m},1):r.box.style.left=b+"em");var x=h?2:3;p>=x-1&&(f?setTimeout(function(){r.wrapper.style[o]=l+"transform",r.wrapper.style[a]="translate(-"+b*(p-x+1)+"em,0)"+m},1):r.wrapper.style.marginLeft="-"+b*(p-x+1)+"em")}r.level=p,y.call(r._itemPath,r._itemPath.length-1,1),S(g,n,s)}u=null,w=null},append:function(n,s){var r=this;if(n&&n.nodeType&&s&&e.isString(s)){var l=O(n);if(l){for(var a,o=parseInt(e.attr(l,"level")),p=0,u=l.nextSibling;p<10&&u;){if(u.nodeType&&e.nodeName(u,"div")&&(" "+u.className+" ").indexOf(" c_popupGroup ")>-1&&o+1==e.attr(u,"level")){a=u;break}u=u.nextSibling,p++}var d=r.id+"_group"+(o+1);if(a&&a.nodeType){e.attr(a,"id")||e.attr(a,"id",d)}else e(r.wrapper).append('<div id="'+d+'" class="c_popupGroup" level="'+(o+1)+'"></div>'),a=i.getElementById(d);var f=d+"_item"+e.md5(s),c="frame_"+f,m=i.getElementById(f);m||(e(a).append('<div id="'+f+'" class="c_popupItem"></div>'),m=i.getElementById(f));var v=i.getElementById(c);if(!v){var y=[];y.push('<iframe id="'+c+'" style="width:100%;height:100%;display:none" frameborder="0"></iframe>'),y.push('<div id="'+c+'_loading" class="c_msg c_msg-full c_msg-loading">'),y.push('<div class="wrapper">'),y.push('<div class="emote"></div>'),y.push('<div class="info"><div class="text"><div class="title" id=id="'+c+'_loading_txt">loading</div></div></div>'),y.push("</div>"),y.push("</div>"),e(m).append(y.join("")),y=null,t[c]=new Wade.Frame(c,{autoInit:!1,title:s})}return l=v=m=a=null,f}}},getFrame:function(e){return t[e]},setPopupReturnValue:function(t,i,n){var s=this;t&&(e.isPlainObject(t)&&(n=i),S(null,t,i,s.srcWindow?s.srcWindow:null),!1!==n&&s.hide(),e.event.trigger("afterAction",null,s.el))},destroy:function(){var t=this;e.zIndexer.remove(t.id),f&&t._unbind(c);var i=e.inArray(t.id,x);i>-1&&y.call(x,i,1),t._itemPath=[],t._itemPath=null,t.srcWindow=null,t.bg=null,t.wrapper=null,t.box=null,t.el=null},_init:function(){var i=this;i.level=1,i.bg=e(i.el).children("div.c_popupBg:first")[0],i.box=e(i.el).children("div.c_popupBox:first")[0],i.wrapper=e(i.el).find("div.c_popupWrapper:first")[0],v.call(x,i.id);var n=i.el.className?i.el.className:"";i.isHalf=(" "+n+" ").indexOf(" c_popup-half ")>-1,i.isFull=(" "+n+" ").indexOf(" c_popup-full ")>-1,i.isHalfBg=(" "+n+" ").indexOf(" c_popup-half-hasBg ")>-1,i.isDefShow=i.defaultShowItemId||(" "+n+" ").indexOf(" c_popup-show ")>-1,i.isHalf&&!i.isHalfBg&&(i.mask=!1,e(i.bg).remove(),i.bg=null),i.bg&&i.bg.nodeType&&e(i.bg).tap(function(){var i=this.className?this.className:"";if(i&&!(" "+i+" ").indexOf(" c_popupBg ")){var n=e(this).parents("div.c_popup:first").attr("id");if(n){var s=t[n];s&&s instanceof e.Popup&&s.hide()}}});var s=i.wrapper.childNodes;if(s&&s.length>0)for(var r,l=0,d=0;l<s.length;)r=s[l],r.nodeType&&e.nodeName(r,"div")&&(" "+r.className+" ").indexOf(" c_popupGroup ")>-1&&(d++,e.attr(r,"level",d)),l++;s=null,i._itemPath=[],f&&(i.el.style[o]="none",i.el.style[p]="300ms",i.el.style[u]="ease-out",i.el.style[a]="translate(100%,0)"+m,i.box.style[o]="none",i.box.style[p]="300ms",i.box.style[u]="ease-out",i.box.style[a]="translate(0,0)"+m,i.wrapper.style[o]="none",i.wrapper.style[p]="300ms",i.wrapper.style[u]="ease-out",i.wrapper.style[a]="translate(0,0)"+m,i._bind(c));var y=i.defaultShowItemId;e("div.c_popupItem",i.el).each(function(){var t=e.attr(this,"id");t&&!y&&(y=t),(" "+(this.className?this.className:"")+" ").indexOf(" c_popupItem-show ")>-1&&this.setAttribute("visible-snapshot",!0),f?(this.style[o]="none",this.style[p]="300ms",this.style[u]="ease-out",this.style[a]="translate(0,0)"+m):(this.style.visibility="visible",this.style.display="none")}),y&&i.isDefShow&&i.show(y)},_findGroup:function(t){var n=this;if(!w.test(t)&&!e.isString(t))return null;if(e.isNumber(t)&&(t<1||t>8))return null;var s=null;if(e.isNumber(t)){var r=n.wrapper.childNodes;if(r&&r.length>0)for(var l,a=0,o=0;a<r.length;){if(l=r[a],l.nodeType&&e.nodeName(l,"div")&&(" "+l.className+" ").indexOf(" c_popupGroup ")>-1&&(o++,t==o)){s=l;break}a++}}else e.isString(t)&&(s=i.getElementById(t));return s},_showItem:function(t,i){var n=this;if(g.test(i)||e.isString(i)){var s=t&&t.nodeType?t:n._findGroup(t);if(s&&s.nodeType){for(var r,p,u,d=e.attr(s,"level")==n.level,c=s.childNodes,v=0,y=0;v<c.length;)p=c[v],1==p.nodeType&&e.nodeName(p,"div")&&(u=p.className?p.className:"",(" "+u+" ").indexOf(" c_popupItem ")>-1&&(y++,e.isNumber(i)&&y==i||e.isString(i)&&i==e.attr(p,"id")?(r=p,p.setAttribute("visible",!0),"visible"!=p.style.visibility&&(p.style.visibility="visible"),f||(p.style.display=""),f&&setTimeout(function(e){return function(){e.style[o]=d?l+"transform":"none",e.style[a]="translate(0,0)"+m}}(p),1),T(p,n.id),N(p),I(p)):(p.setAttribute("visible",!1),f&&!d?p.style.visibility="hidden":f||(p.style.display="none"),f&&setTimeout(function(e){return function(){e.style[o]=d?l+"transform":"none",e.style[a]="translate(100%,0)"+m}}(p),1)))),v++;return r}}},_bind:function(e,t,n){var s=this;i.addEventListener&&(t||s.el).addEventListener(e,s,!!n)},_unbind:function(e,t,n){var s=this;i.removeEventListener&&(t||s.el).removeEventListener(e,s,!!n)},_transitionEnd:function(t){var i=this,n=t.target;if(n&&n.nodeType){var s=n.className?n.className:"";if((" "+s+" ").indexOf(" c_popup ")>-1){if(0==i.visible){n.style.visibility="hidden";var r=e("div[visible=true]",i.el);r.attr("visible",!1),r.attr("visible-snapshot",!0),r.css("visibility","hidden"),r=null}}else(" "+s+" ").indexOf(" c_popupBox ")>-1||(" "+s+" ").indexOf(" c_popupWrapper ")>-1||(" "+s+" ").indexOf(" c_popupItem ")>-1&&"false"==n.getAttribute("visible")&&(n.style.visibility="hidden");(" "+s+" ").indexOf(" c_popup ")>-1&&(n.style[o]="none")}}}),e.extend(_,{back:function(i){var n=!1;return e.zIndexer.each(function(s,r){if(e.inArray(r,x)>-1&&t[r]&&t[r]instanceof _&&(void 0===i||1==i&&i==t[r].mask))return t[r].back(),n=!0,!1}),n}});var T=function(i,n){if(e.Frame&&e.isFunction(e.Frame)&&e.Frame.prototype._init){var s,r;e("iframe[x-wade-uicomponent=frame]",i).each(function(){s=e.attr(this,"id"),(r=t[s])&&r instanceof e.Frame&&(r.setAttribute("popupId",n),!0!==r.inited?setTimeout("window['"+s+"'].init()",f?350:0):setTimeout("window['"+s+"'].adjust();",f?350:0))})}},N=function(i){if(e.Scroller&&e.isFunction(e.Scroller)&&e.Scroller.prototype._init){var n,s;e("div[x-wade-uicomponent=scroller]",i).each(function(){n=e.attr(this,"id"),(s=t[n])&&s instanceof e.Scroller&&setTimeout("window['"+n+"'].refresh()",f?350:0)})}},I=function(i){if(e.Table&&e.isFunction(e.Table)&&e.Table.prototype._init){var n,s;e("div[x-wade-uicomponent=table]",i).each(function(){n=e.attr(this,"id"),(s=t[n])&&s instanceof e.Table&&setTimeout("window['"+n+"'].adjust()",f?350:0)})}},O=function(t){if(!t||!t.nodeType)return null;for(var n=0,s=t.parentNode;n<20&&s&&s.nodeType&&s!=i.body;){if(e.nodeName(s,"div")&&(" "+s.className+" ").indexOf(" c_popupGroup ")>-1)return s;s=s.parentNode,n++}},S=function(i,n,s,r){var l=r||t,a=i?e("iframe[x-wade-uicomponent=frame]",i)[0]:null;if(a&&a.nodeType&&e.nodeName(a,"iframe")&&(l=a.contentWindow),l&&l.Wade&&l.$)if(e.isString(n))l.$("#"+n).val(s);else if(e.isPlainObject(n))for(var o in n)l.$("#"+o).val(n[o])};s=null,t.Popup=e.Popup=_}}(window.Wade,window,document);